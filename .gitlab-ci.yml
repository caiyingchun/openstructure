# these are the different stages for our pipelines
# jobs in the same stage run in parallel 
# next stage doesn't start until previous stage finishes OK
# by now we only do build and test, we could add another stage "deploy" if needed
stages:
  - build
  - test

# this is executed before doing anything else
before_script:
  - echo "hi, I am the before script"

# BUILD STAGE
build:centos6.6:
  stage: build
  image: centos:6.6
  script:
  - echo "Hi from the centos 6.6 container. I am in the build stage"
  - cat /etc/redhat-release
  - echo "Trying to list the contents of /export/soft"
  - ls /export/soft
  - mkdir -p /scicore/soft/{apps,modules}
  - ln -s /scicore/soft/apps /export/soft/apps/centos6/generic
  - ln -s /scicore/soft/modules /export/soft/modules/centos6/generic/all
  - source /export/soft/lua_lmod/centos6/lmod/lmod/init/bash
  - module use /scicore/soft/modules/all
  - module av

build:centos7.3:
  stage: build
  image: centos:7.3.1611
  script:
  - echo "Hi from the centos 7.3 container. I am in the build stage"
  - cat /etc/redhat-release
  - echo "Trying to list the contents of /export/soft"
  - ls /export/soft

# TESTS STAGE
test:centos6.6:
  stage: test
  image: centos:6.6
  script:
  - echo "Hi from the centos 6.6 container. Here I run unit tests if build finished ok"
  - cat /etc/redhat-release

test:centos7.3:
  stage: test
  image: centos:7.3.1611
  script:
  - echo "Hi from the centos 7.3 container. Here I run unit tests if build finished ok"
